{% extends "layout.html" %}
{% block title %}トーク履歴{% endblock %}
{% block header %}トーク履歴: {{ user.nickname or user.display_name or user.id }}{% endblock %}

{% block content %}
<style>
    .chat-header { 
        padding: 1em; 
        background-color: #f8f9fa; 
        border: 1px solid var(--border-color); 
        border-bottom: none; 
        border-radius: 8px 8px 0 0; 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        flex-wrap: wrap;
    }
    .status-form select { 
        padding: 5px; 
        border-radius: 4px; 
        border: 1px solid #ccc;
    }
    .chat-container { 
        display: flex; 
        flex-direction: column; 
        height: 70vh; /* 少し高さを調整 */
    }
    /* (省略... message-history, message, reply-form などのスタイルは変更なし) */
</style>

<div class="content-panel">
    <div class="chat-header">
        <div>
            <strong>現在のステータス:</strong> {{ user.status }}
            <button onclick="openModal('{{ url_for('edit_user_page', user_id=user.id) }}')" style="margin-left: 15px;">ユーザー情報編集</button>
        </div>
        <form class="status-form" action="{{ url_for('update_status', user_id=user.id) }}" method="post" style="display: flex; align-items: center; gap: 10px;">
            <select name="status">
                <option value="未対応" {% if user.status == '未対応' %}selected{% endif %}>未対応</option>
                <option value="対応中" {% if user.status == '対応中' %}selected{% endif %}>対応中</option>
                <option value="対応済み" {% if user.status == '対応済み' %}selected{% endif %}>対応済み</option>
                <option value="要対応" {% if user.status == '要対応' %}selected{% endif %}>要対応</option>
            </select>
            <button type="submit">変更</button>
        </form>
    </div>

    <div class="chat-container">
        <div class="message-history">
            {% for msg in messages %}
            <div class="message-row {{ msg.sender_type }}">
                <div class="message {{ msg.sender_type }}">
                    {{ msg.content }}
                </div>
            </div>
            {% endfor %}
        </div>
        <div class="reply-form">
            <form action="{{ url_for('send_reply', user_id=user.id) }}" method="post" style="display: flex; width: 100%;">
                <textarea name="message_text" placeholder="メッセージを入力..." rows="1"></textarea>
                <button type="submit">➤</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}