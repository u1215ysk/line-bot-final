{% extends "layout.html" %}
{% block title %}トーク履歴{% endblock %}
{% block header %}トーク履歴: {{ user.nickname or user.display_name or user.id }}{% endblock %}

{% block content %}
<style>
    .chat-container { display: flex; flex-direction: column; height: 75vh; }
    .message-history { flex-grow: 1; overflow-y: auto; padding: 1em; background-color: #e9e9e9; border: 1px solid var(--border-color); border-bottom: none; border-radius: 8px 8px 0 0; }
    .message { max-width: 70%; padding: 10px 15px; border-radius: 18px; margin-bottom: 10px; line-height: 1.4; }
    .message.user { background-color: #ffffff; align-self: flex-start; }
    .message.admin { background-color: #dcf8c6; align-self: flex-end; }
    .message-row { display: flex; flex-direction: column; }
    .message-row.user { align-items: flex-start; }
    .message-row.admin { align-items: flex-end; }
    .reply-form { display: flex; padding: 1em; background-color: #f0f0f0; border: 1px solid var(--border-color); border-top: none; border-radius: 0 0 8px 8px; }
    .reply-form textarea { flex-grow: 1; border-radius: 18px; padding: 10px 15px; border: 1px solid #ccc; resize: none; }
    .reply-form button { margin-left: 1em; border-radius: 50%; width: 40px; height: 40px; padding: 0; font-size: 1.5em; line-height: 40px; }
</style>

<div class="content-panel">
    <div class="chat-container">
        <div class="message-history">
            {% for msg in messages %}
            <div class="message-row {{ msg.sender_type }}">
                <div class="message {{ msg.sender_type }}">
                    {{ msg.content | nl2br }}
                </div>
            </div>
            {% endfor %}
        </div>
        <div class="reply-form">
            <form action="{{ url_for('send_reply', user_id=user.id) }}" method="post" style="display: flex; width: 100%;">
                <textarea name="message_text" placeholder="メッセージを入力..." rows="1"></textarea>
                <button type="submit">➤</button>
            </form>
        </div>
        </div>
</div>
{% endblock %}