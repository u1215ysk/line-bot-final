# Koyebのサービス設定ファイル

# アプリケーションの名前 (あなたのKoyeb上のApp名に合わせてください)
name: line-bot-final-app

# このファイルで定義するサービスの一覧
services:
  # 1. Webサービス（LINEからの通知や管理画面を受け取る）
  - name: web
    docker:
      dockerfile: Dockerfile
    instance_type: free
    ports:
      - port: 8080
        protocol: http
    health_checks:
      - path: "/"
        port: 8080
        protocol: http

  # 2. Workerサービス（ステップ配信・予約投稿を実行）
  - name: step-delivery-worker
    docker:
      dockerfile: Dockerfile
      command: python step_delivery.py
    instance_type: free
    cron: "* * * * *" # 毎分実行

# 全てのサービスで共通して使う環境変数
env:
  # ▼▼▼ 秘密ではない情報はここに直接記述 ▼▼▼
  - key: PYTHON_VERSION
    value: "3.11.9"
  - key: ADMIN_USERNAME
    value: "admin" # あなたが設定したユーザー名に変更してください

  # ▼▼▼ 秘密情報は、Koyebの「Secret」機能から名前で参照 ▼▼▼
  - key: DATABASE_URL
    secret: "DATABASE_URL"
  - key: ADMIN_PASSWORD
    secret: "ADMIN_PASSWORD"
  - key: LINE_CHANNEL_ACCESS_TOKEN
    secret: "LINE_CHANNEL_ACCESS_TOKEN"
  - key: LINE_CHANNEL_SECRET
    secret: "LINE_CHANNEL_SECRET"